---
title: 封装一个表单验证（针对）
date: 2022-10-06 22:27:28
tags: 原生
category: JavaScript
---

### 解决问题？

由于在工作中，公司 h5 项目 对 vant 的 表单验证 不太理想，业务需要 toast 提示验证，而非表单中的函数验证。所以在验证校验时，使用了大量的 if else 判断。代码臃肿 重复 。这些面向过程的编码行为逻辑又不能进行封装。

```
            var name = this.username.value;
            var pwd1 = this.password1.value;
            var pwd2 = this.password2.value;
            var tel = this.phone.value;
            if (name.replace(/(^\s*)|(\s*$)/g, "") === "") {
                alert('用户名不能为空')
                return false
            }
            if (pwd1.replace(/(^\s*)|(\s*$)/g, "") === "") {
                alert('密码不能为空')
                return false
            }
             if (pwd2.replace(/(^\s*)|(\s*$)/g, "") === "") {
                alert('确认密码不能为空')
                return false
            }
            if (pwd2 !== pwd1) {
                alert('确认密码与原密码不相同！')
                return false
            }
            if (tel.replace(/(^\s*)|(\s*$)/g, "") === "") {
                alert('手机号码不能为空')
                return false
            }
            if (!/^1[3,4,5,7,8,9][0-9]\d{8}$/.test(tel)) {
                alert('手机号码格式不正确')
                return false
            }

```

#### 思路

-   首先将 定义一个对像 rules 将校验规则存起来
-   将逻辑进行抽离 校验值 与 Dom 无关（因为不用将某项的提示信息放到当前项）
-   推理，使用方式 `{ formKey:[{verifyName：'isRequired',verifyVal:'11',msg:'提示信息'}] }`（这里将校验值传递进来，便于处理，不用通过虚拟 dom 获取 ）
-   封装处理方法 获取对象中 key 的数组 每一项的校验名称、值、错误提示 一一比对

### 实现

```
            function Validate() {}
            // 四个功能函数， 通过外部 调用rules[名称]获取
            Validate.prototype.rules = {
                // 是否手机号
                isMobile: function (str) {
                    let rule = /^1[3,4,5,7,8,9][0-9]\d{8}$/;
                    return rule.test(str);
                },
                // 是否必填
                isRequired: function (str) {
                    // 除去首尾空格
                    let value = str.replace(/(^\s*)|(\s*$)/g, "");
                    return value !== "";
                },
                // 最小长度
                minLength: function (str, length) {
                    let strLength = str.length;
                    return strLength >= length;
                },
                // 是否相等
                isEqual: function () {
                    // 可以接收多个参数比较
                    let args = Array.prototype.slice.call(arguments);
                    // 取首项与后面所有的项比较，如果每个都相等，就返回true
                    let equal = args.every(function (value) {
                        return value === args[0];
                    })
                    return equal;
                }
            }
            Validate.prototype.test = function (rules) {
                let v = this;
                let valid; // 保存校验结果
                // 外部传递的规则配置参数rules
                for (let key in rules) {
                    for (let i = 0; i < rules[key].length; i++) { // 遍历每一个字段的校验规则
                        let ruleName = rules[key][i].rule; // 规则名
                        let value = rules[key][i].value; // 获校验值
                        if (!Array.isArray(value)) { // 统一校验值为数组类型
                            value = new Array(value)
                        }
                        let result = v.rules[ruleName].apply(v, value); // 调用校验规则方法进行校验
                        if (!result) { // 如果校验不通过，就获取校验结果信息，并立即跳出循环不再执行，节约消耗
                            valid = {
                                errValue: key,
                                errMsg: rules[key][i].message
                            }
                            break;
                        }
                    }
                    if (valid) { // 如果有了校验结果，代表存在不通过的字段，则立即停止循环，节约消耗
                        break;
                    }
                }
                return valid; // 把校验结果返回出去
            }
            // 封装之后 我们只需每次将构造函数实例话 进行这样的穿参
            let formData = document.getElementById('form')
            formData.onsubmit = function () {
                event.preventDefault()
                let validator = new Validate();
                // 验证规则 抽离出来， 便于更为灵活的应用验证器
                //  验证器已经和DOM解耦，只关心规则和数据以及message
                let res = validator.test({ // 和id一致才能获取
                    username: [{
                        rule: 'isRequired',
                        value: this.username.value,
                        message: '用户名不能为空！'
                    }],
                    password1: [{
                            rule: 'isRequired',
                            value: this.password1.value,
                            message: '密码不能为空！'
                        },
                        {
                            rule: 'minLength',
                            value: [this.password1.value, 6],
                            message: '密码长度不能小于6个字符！'
                        }
                    ],
                    password2: [{
                            rule: 'isRequired',
                            value: this.password2.value,
                            message: '确认密码不能为空！'
                        },
                        {
                            rule: 'minLength',
                            value: [this.password2.value, 6],
                            message: '确认密码长度不能小于6个字符！'
                        },
                        {
                            rule: 'isEqual',
                            value: [this.password2.value, this.password1.value],
                            message: '确认密码与原密码不相同！'
                        }
                    ],
                })
                if (res) {
                    console.log(res)
                    this.$tost.error(res)
                } else {
                    console.log('校验通过')
                }
            }
```

`![BG图片](/img/default.jpg)`
![BG图片](/img/1.jpg)
