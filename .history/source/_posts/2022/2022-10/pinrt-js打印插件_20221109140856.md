---
title: 整理项目中实现的打印功能
date: 2022-10-28 21:27:28
tags: 插件
category: JavaScript
---

## 打印功能 
    打印功能的业务场景有很多种，如项目中的数据图片、一些快照等，常规使用下面两种方式  
1. [window.print()](https://www.w3cschool.cn/jsref/met-win-print.html)方法用于打印当前窗口的内容
2. 后台做打印相关处理，前端利用pdf格式性质进行打印
浏览文本，当即将浏览到图片时，进行加载动画。

## 调用浏览器的print方法
  1. 直接调用window.print()基础方式唤醒浏览器的打印功能，用于打印当前的窗口内容
  ```
    <button class="pbtn" @click="handelPrint">打 印</button>
          <ul>
              <li
                  style="height: 100px; margin: 10px 0px; background-color: #ccc"
                  v-for="item in 50"
                  :key="item"
              >
                  打印内容{{ item }}
              </li>
          </ul>
     methods: {
		  handelPrint() {
		        window.print();
		   }
	 }
  ```
  ## 使用插件方式
   使用插件的方式，有很多现成的库，用过两个 [vue-print-nb](https://www.npmjs.com/package/vue-print-nb) [print-js](https://www.npmjs.com/package/print-js) [官网](https://printjs.crabbly.com/)
   ### vue-print-nb 引入  [vue-print-nb博客](https://www.jianshu.com/p/d19270c237ad)
   ```
   npm i vue-print-nb // vue2.x
   npm i vue3-print-nb // vue3
   //全局 引入
   // vue2 与vu3 注册方式有所区别 主要以Options API和 Composition API 
   
   import  Print from 'vue-print-nb'  或者 ‘vue3-print-nb’	
  
   Vue.use(Print) //vue2.x
   ...
   // vue3 中是注册到 createApp 函数构建的app 中
   import { createApp } from 'vue'
   import App from './App'
   const app = createApp(App)
   app.use(Print)
   ...
   // 局部引用 在对应页面组件中注册 
    import  Print from 'vue-print-nb'  或者 ‘vue3-print-nb’	
	
	directives: { Print }
   ```
   #### 实现打印功能
   ```
   <button class="pbtn" v-if="printset">打 印</button>
         <ul id="printWrap">
             <li
                 style="height: 100px; margin: 10px 0px; background-color: #ccc"
                 v-for="item in 50"
                 :key="item"
             >
                 打印内容{{ item }}
             </li>
			 <div class="noprint">不需要打印的内容</div> // 不需要打印的内容 添加noprint 类
         </ul>
		 
		 <div style="page-break-after: always;">我是本页的末尾哦</div> //需要分页的
   data(){
	   return {
		 // 配置项  
   	  printset:{
		    id: 'printWrap',
		    popTitle: '打印', // 打印配置页上方标题
		    extraHead: '', //最上方的头部文字，附加在head标签上的额外标签,使用逗号分隔
		    preview: '', // 是否启动预览模式，默认是false（开启预览模式，可以先预览后打印）
		    previewTitle: '', // 打印预览的标题（开启预览模式后出现）,
		    previewPrintBtnLabel: '', // 打印预览的标题的下方按钮文本，点击可进入打印（开启预览模式后出现）
		    zIndex: '', // 预览的窗口的z-index，默认是 20002（此值要高一些，这涉及到预览模式是否显示在最上面）   
		    previewBeforeOpenCallback() {}, //预览窗口打开之前的callback（开启预览模式调用）
		    previewOpenCallback() {}, // 预览窗口打开之后的callback（开启预览模式调用）
		    beforeOpenCallback() {}, // 开启打印前的回调事件
		    openCallback() {}, // 调用打印之后的回调事件
		    closeCallback() {}, //关闭打印的回调事件（无法确定点击的是确认还是取消）
		    url: '',
		    standard: '',
		    extraCss: '',
	  }
	   }
   }
    // 样式
	<style media="print">
	@page {
	  size: auto;
	  margin: 0 10mm;
	}
	
	html {
	  background-color: #fff;
	  height: auto;
	  margin: 0px;
	}
	</style>
   ```
   ### [print-js](https://www.npmjs.com/package/print-js) 插件打印 
  一篇比较详细的[博客](https://www.jianshu.com/p/f6f09dd9f7db)
   ```
   //安装
   npm i print-js -S 
   
   // 引入 
   import Print from 'print-js'
   
   ```
  #### 实现打印功能
   ![图片1](/img/1.jpg) 
```
<template>
    <div>
      
        <el-button class="pbtn" @click="bindPrint" type="primary"
            >打 印</el-button
        >
        <div class="box_wrap">
            <div id="printWrap" class="print-page-wrap" ref="printWrap">
			    <header class="page-header">
                  <div ref="Page_title" id="Page_title">
                    <h2 class="print-h2 fw-6">
                        {{ headerTitle }}
                    </h2>
                    <h3 class="print-h3 fw-6">治疗记录</h3>
                  </div>
                    <div class="print-base-wrap">
                       <InfoSpan label="姓名：" :val="infoPrint.consumerName" />
                       <InfoSpan label="性别：" :val="infoPrint.gender" />
                       <InfoSpan label="年龄：" :val="infoPrint.consumerAge" />
                       <InfoSpan label="家床号：" :val="infoPrint.bedRegId" />
                    </div>
                    <h5 class="mtb_10 fsw-28">康复诊断:</h5>
                </header>
                <section class="print">
                    <template>
					  <Gtable
					   :titles="titles"
					   :tabData="tabdata"
					   operateShow
					   size="mini"
					   border
					   >
					  </Gtable> 
                    </template>
                    <h5 class="h5_title"></h5>
                    <div v-for="(item, index) in detaildata" :key="index">
					    <Gtable
					       :titles="titles"
					       :tabData="item"
					       operateShow
						   size="mini"
						   border
					    >
					    </Gtable>                    
                        <footer class="print-footer">
                            <div>
                                疗效评定：
                                <span class="info-val">{{
                                    item.effectName
                                }}</span>
                            </div>
                            <div>
                                签名：
                                <span class="info-val">{{
                                    item.effectDoctorName
                                }}</span>
                            </div>
                        </footer>
                    </div>
                </section>
            </div>
        </div>
    </div>
</template>

methods:{
	   bindPrint() {
	         
	            printJS({
	                printable: 'printWrap', //绑定的id
	                type: 'html', //类型
	                maxWidth: 1300, // 打印的尺寸 
	                header: `<div style="text-align: center; line-height: 16px;"><h1  > ${this.headerTitle}</h1><h2 style="line-height: 16px; font-size: 28px;" >治疗记录</h2></div>`,// 设置的打印头标题
	                ignoreElements: ['Page_title'],//不打印的元素id
	                targetStyles: ['*'],// 继承属性
	                scanStyles: true,///继承当前html结构所用的样式表.
	                style: '@page { margin: 0 10mm }',//可选 打印时去掉页眉页尾
	        });
	    },
}

```
   ###### 调整打印字体
   在这里调整font_size 的数值 一定程度下 浏览器打印字体不会变小
   ![dayin_js2](/img/1.jpg)
### 服务端返回[blob](https://developer.mozilla.org/zh-CN/docs/Web/API/Blob)流 转换为pdf 唤醒浏览器pdf打印 [window.open()](https://www.runoob.com/jsref/met-win-open.html)
  Blob 对象表示一个不可变、原始数据的类文件对象。它的数据可以按文本或二进制的格式进行读取，也可以转换成 ReadableStream 来用于数据操作

```
 // 封装api
      openPdf (url, params = {}) {
          get(`${FDAPP_HOST}${url}`, { params,responseType: 'blob' ,headers: { backdoor: true} }).then(res => {
              const blob = new Blob([res], {
                  type: 'application/pdf'
              });
              var href = window.URL.createObjectURL(blob);
              window.open(href);
          }, err => {
              console.log(err);
          });
      }
```

![BG图片](/img/1.jpg)
